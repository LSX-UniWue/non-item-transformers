# Project Code Overview #
After installing the virtual environment as described in the [README.md](../README.md) setup your IDE
to use the virtual environment generated by Poetry. It is commonly found under `recommender/venv/recommender`.

The project is structured into 5 folders:

* [configs](./../configs): Contains jsonnet files which are needed to configure the uses of models in conjunction with metrics and datasets
* [docs](./../docs): Contains Markdown files which contain the documentation for this project
* [k8s](./../k8s): Contains a dockerfile which defines a docker container which runs a model when started, an example for a kubernetes job and pod configuration for said dockerfile
* [src](./../src): TODO
* [tests](./../tests): Contains unit tests for the project and an example dataset as well as the respective vocabulary and index file

The [src](./../src) folder contains 4 folders:

* [asme](./../src/asme): TODO
    * [init](./../src/asme/init): TODO
    * [losses](./../src/asme/losses): Contains code regarding custom loss functions which can be integrated into pytorch training
    * [metrics](./../src/asme/metrics): Contains code regarding the implementation of recommendation metrics which are integrated using pytorch
    * [models](./../src/asme/models): Contains pytorch implementations of the models provided by this framework
    * [modules](./../src/asme/modules): Contains pytorch-lightning wrappers for the pytorch models defined in [models](./../src/asme/models)
    * [tokenization](./../src/asme/tokenization): Contains code concerning the tokenization of session items and the building of a vocabulary for datasets
    * [utils](./../src/asme/utils): TODO
    * [writer](./../src/asme/writer): TODO
* [data](./../src/data): Contains code regarding the indexing of datasets and reading of stored indices
* [dataset](./../src/dataset): The default folder for storing datasets
* [datasets](./../src/datasets): Contains code regarding the integration of datasets into the framework


## Adding a new Metric ##
The metric needs to be able to handle tensors to be compatible with pytorch.

To implement it go to [metrics/ranking_metrics](../asme/metrics/ranking_metrics.py) and implement a new metrics class.

## Adding a new Dataset ##
All necessary files for the integration of datasets can be found under the [dataset folder](./../src/datasets).

In order to add a new dataset and make it usable you have to implement the following steps:
1. Download the dataset or document where it is available
2. Index the dataset and create train, validation, test split
3. Create a vocabulary for the dataset
4. Integrate those steps into the dataset [Typer](https://typer.tiangolo.com/) CLI as a new command under 
[datasets/app/data_set_commands.py](./../src/datasets/app/data_set_commands.py)

## Adding a new Model ##
In order to add a new model multiple things need to be implemented:
1. The model itself as a pytorch model in [models](./../src/asme/models)
2. A pytorch lightning module that wraps the torch implementation of your newly implemented model in 
    [modules](./../src/asme/modules)
3. A generic module factory in [init/factories/container.py](./../src/asme/init/factories/container.py)

## Things that are not documented ##
This section lists areas of the project that are not documented/need code comments:
* Contents of the "support-code" in [asme/utils](./../src/asme/utils) 
* Most methods, classes, and modules

## Refactor proposals ##
* The prediction logger callback for pytorch lightning is contained in [runner/util](../asme/runner/util)
    (I [AL] would expect this to be at [logger](./../logger))
* The code in [runner/util](../asme/runner/util) is quite extensive and should probably be moved into multiple separate
directories (e.g. [runner/util/containers](../asme/runner/util/containers.py) could be a directory)
* Every directory deserves its own little README.md describing its purpose, contents, and implementation hints 
    in a few sentences
* If this project aims to become a CLI one day the project structure should represent that by:
    + Either: directories should be structured into commands
    + Or: An app directory should be created in which commands are defined and registered at one central file
* If a class is defined in a file the file should have the same name as the class (e.g., 
    [indexer.py](./../data/base/indexer.py) defines the CsvSessionIndexer class)
* If a file defines multiple classes make it a directory.
* Rename [dm](./../dm) to datamodules or remove it
